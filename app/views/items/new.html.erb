<!-- Facebook SDK -->
<script>
  window.fbAsyncInit = function() {
    FB.init({
      appId      : '744629489021986',
      xfbml      : true,
      version    : 'v2.8'
    });
    FB.AppEvents.logPageView();
  };

  (function(d, s, id){
     var js, fjs = d.getElementsByTagName(s)[0];
     if (d.getElementById(id)) {return;}
     js = d.createElement(s); js.id = id;
     js.src = "//connect.facebook.net/en_US/sdk.js";
     fjs.parentNode.insertBefore(js, fjs);
   }(document, 'script', 'facebook-jssdk'));
   
	// Only works after `FB.init` is called
	function myFacebookLogin() {
  		FB.login(function(){
  		
  		// display modal
  		$('#facebook_images').modal('show');
  		
  		// get all albums
		FB.api('/me/albums?fields=id,name', function(response) {
		  
		  for (var i=0; i<response.data.length; i++) {
		    var album = response.data[i];
		 
		    $('#albums').append('<button class="btn btn-default btn-lg" \
		    						data-toggle="collapse"	\
		    						data-target="#' + album.id + '"	\
		    						style="width: 100%">' + album.name + '</button>');
		    	
		    	$('#albums').append('<div class="collapse" id="' + album.id + '"></div>');			
			
			
		    FB.api('/'+album.id+'/photos?fields=picture,album,images', function(photos){
		    	 
		    	  
		      if (photos && photos.data && photos.data.length){
		        for (var j=0; j<photos.data.length; j++){
		          var photo = photos.data[j];
		          photo.images.sort(function(a, b) { return b.width - a.width;})
		          var large_image_url = photo.images[0].source
		          // photo.picture contain the link to picture          
		          $('#' + photo.album.id).append('<img src="' + photo.picture + '" \
		          								 class="facebook_image" id="' + large_image_url + '"></img>');
		        }
		      }
		    });
		
		  }

			  
		  
		});
  			
  			
  		}, {scope: 'user_photos'});
	}
	
	$('body').on('click','img.facebook_image', function() {
    $('#facebook_upload').attr('value', $(this).attr('id'));
	});	

</script>

<!-- Modal -->
<div class="modal fade" id="facebook_images" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-dialog" role="document" style="width: 1000px">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">Choose your facebook image</h4>
      </div>
      <div class="modal-body">
      	
      	<div id="albums">
      		
      	</div>

        	
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
		<%= form_for @item do |f| %>
			<%= hidden_field_tag :facebook_image_url, true, id: "facebook_upload" %>
			<%= hidden_field_tag :image_upload, true %>
			<%= hidden_field_tag :upload_from_facebook, true %>
		<%= f.submit 'Upload', class: "btn btn-primary"%>
		<% end %>
      </div>
    </div>
  </div>
</div>

<%= render "layouts/navbar" %>

<!-- Image to replace radio button -->
<style>
	label > input.radio_hide {/* HIDE RADIO */
		visibility: hidden; /* Makes input not-clickable */
		position: absolute; /* Remove input from document flow */
	}
	label > input + img {/* IMAGE STYLES */
		cursor: pointer;
		border: 2px solid transparent;
	}
	label > input:checked + img {/* (RADIO CHECKED) IMAGE STYLES */
		border: 2px solid #f00;
		padding: 5px;
	}

</style>

<div class="container" style="margin-top:100px; margin-bottom: 100px">

	<div class="row">
		<div class="col-md-8">
			<!-- Validation -->
			<% if @item.errors.any? %>
			<div id="error_explanation">
				<h4 class="no_bold" style="color: red"> Please fix these <b id="error_number" ><%= pluralize(@item.errors.count, "issue") %></b> before continue.</h2>
			</div>
			<% end %>

			<!-- Select Image -->
			<%= render 'select_image' %>

			<%= form_for :item, url: item_path(@item), method: :patch do |f| %>
			
			<!-- Select Filter -->
			<%= render partial: 'select_filter',  locals:{f: f} %>

			<!-- Select Product -->
			<%= render partial: 'select_product', locals:{f: f} %>

			<!-- Select Size -->
			<%= render partial: 'select_size', locals:{f: f} %>

			<!-- Select Depth and Border -->
			<%= render partial: 'select_depth_and_border', locals:{f: f}%>

		</div>
		<div class="col-md-4" >
			<!-- Image overview on right side -->
			<%= render partial: 'item_overview', locals: {f: f}%>
		</div>
		<% end %>
	</div>
</div>

<!-- Pop up Modal for crop -->
<% if !@crop_image.nil? && @crop_image %>
<%= render 'crop' %>
<% end %>

<script>

	
	$("#art_filter_checkbox").change(function() {
		if (this.checked) {
			//use original image
			$('#the_image').attr('src', '<%= @item.image.overview.url %>');
		} else {
			//use art filter
			$('#the_image').attr('src', '<%= @item.art_image.url %>');
		}
	});
	
	$("#product_canvas").click(function() {
		$('#product_choice').text('Type: canvas')
	});
	$("#product_frame").click(function() {
		$('#product_choice').text('Type: frame')
	});

	$("#item_size").change(function() {
		$('#size_choice').text('Size: ' + this.value)
	});

	$("#item_size").change(function() {
		$('#price_choice').text('Price: ' + $("#item_size option:selected").text().split(' ')[2])
	});

	$("#depth_0").click(function() {
		$('#depth_choice').text('Depth: 0"')
	});

	$("#depth_0_75").click(function() {
		$('#depth_choice').text('Depth: 0.75"')
	});

	$("#depth_1_5").click(function() {
		$('#depth_choice').text('Depth: 1.5"')
	});

	$("#depth_2_5").click(function() {
		$('#depth_choice').text('Depth: 2.5"')
	});
	$("#border_photo").click(function() {
		$('#border_choice').text('Border: photo')
	});

	$("#border_black").click(function() {
		$('#border_choice').text('Border: black')
	});

	$("#border_white").click(function() {
		$('#border_choice').text('Border: white')
	});

</script>
