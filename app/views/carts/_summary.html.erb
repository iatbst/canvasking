<div class="col-md-2">
	<div class="box" id="summary_box" align="center" style="width:350px; margin-left:20px;">

		<h3 style="margin-top: 20px; font-weight: 900">订单</h3>
		<hr style="width: 80% ; border-width: 1px; border-color:#E2E2E2;"/>

		

		<div class="row coupon_box" style="" id="coupon_desc">
			<h4 id="coupon_applied">
				
				<% if cart.items[0].plan == 1 %>
					<%= "VPN 套餐: 1个月" %>
				<% elsif cart.items[0].plan == 2 %>
					<%= "VPN 套餐: 3个月" %>
				<% else %>
					<%= "VPN 套餐: 12个月" %>
				<% end %>
				
			</h4>
		</div>
		

		<div class="row">
			<div class="col-md-5 col-md-offset-1" align="right">
				<h4 style="font-weight: 300">
					原价 : 
				</h4>
			</div>
			
			<div class="col-md-6" align="left">
				<h4 style="font-weight: 900; color: lightgrey; text-decoration: line-through">
					$
					<span id="old_price">
						<%= (cart.price.to_f/0.5).round(2) %>
					</span>
				</h4>
			</div>
		</div>		
	
	
		
		<hr style="width: 60%; border-color: black;margin: 5px" />

		<div class="row">
			<div class="col-md-5 col-md-offset-1" align="right">
				<h4 style="font-weight: 300">
					折扣价 : 
				</h4>
			</div>
			
			<div class="col-md-6" align="left">
				<h4 style="font-weight: 900">
					<span id="total_price">
							$<%= cart.price.to_f %>
					</span>			
				</h4>
			</div>
		</div>
	
				
	
		<%= button_to '结算', new_order_path, method: :get, class:"btn btn-primary btn-lg", style:"width: 80%; margin-top: 20px", id: 'checkout_button'%>
		<br />

		<%= button_to '改变套餐', '/#plans', method: :get, class:"btn btn-secondary btn-lg blue_button", style:"width: 80%; margin-bottom: 20px", id: 'continue_shopping_button' %>
		<br />
		<%= button_to '删除套餐', get_current_cart.items[0], method: :delete, class:"btn btn-secondary btn-lg blue_button delete_button", style:"width: 80%; margin-bottom: 20px" %>
		
	</div>
</div>


<script>

	// Using Jquery to apply coupon
	$("#apply_coupon_button").click(function() {
		// get quantity
		var code = $('#coupon_code_input').val();
		var url = "/carts/apply_coupon";
		$.ajax({
			url : url,
			type : 'POST',
			data: {'coupon_id': $('#coupon_code_input').val() },
			success : function(result) {
				// Update item quantity on page
				if (result['error']){
					$('#coupon_error_msg').text(result['error']);		
				} else if (result['remove_coupon']){
					$('#coupon_section').hide();
					$('#coupon_desc').hide();
					$('#coupon_applied').empty();
				} else {
					
					// update price in summary	
					$('#coupon_section').show();
					$('#coupon_desc').show();
					$('#coupon_saving').show();
					$('#original_price').text('$' + result['price']);
					if (parseInt(result['item_count']) > 1 ) {
						$('#item_count').text(result['item_count'] + ' Items');
					} else {
						$('#item_count').text(result['item_count'] + ' Item');
					}					
					$('#coupon_saving_value').text('-$' + result['saving']);
					$('#total_price').text('$' + result['discount_price']);
					
					// clear current coupon
					$('#coupon_applied').empty();
					
					// append coupon 
					$('#coupon_applied').append('<span class="glyphicon glyphicon-ok" style="color: green"></span> ' + result['desc'] );
					
				}
				
			}
		});
		$('#coupon_error_msg').text('');
	});

	// Using Jquery to cancel coupon
	function remove_coupon() {
		// get quantity
		var url = "/carts/remove_coupon";
		$.ajax({
			url : url,
			type : 'GET',
			success : function(result) {
				// Update item quantity on page
				if (result['error']){
					$('#coupon_error_msg').text(result['error']);
				} else {
					// update price in summary
					$('#coupon_saving').hide();
					$('#total_price').text('$' + result['price']);
					$('#original_price').text('$' + result['price']);
					if (parseInt(result['item_count']) > 1 ) {
						$('#item_count').text(result['item_count'] + ' Items');
					} else {
						$('#item_count').text(result['item_count'] + ' Item');
					}	
										
					// remove coupon 
					$('#coupon_applied').html('');
				}
				
			}
		});
		$('#coupon_error_msg').text('');
	}

    $('.delete_button').on('click', function () {
        if (confirm('Are you sure to remove this item from cart ?')){
        	$.LoadingOverlay("show");
        } else {
        	return false;
        }
    });
	
</script>