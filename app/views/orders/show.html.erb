<%= render "layouts/navbar" %>

<div class="container" style="margin-top: 70px; margin-bottom: 20px" >
	<h3 class="no_bold">Order # <%= @order.number %></h3>
	<div class="row box">
		<div class="col-md-3">
			<br />
			<h5><b>Shipping Address</b></h5>
			<%= @order.shipping_full_name %>
			<br />
			<%= @order.shipping_address_1 %>
			<br />
			<% if !@order.shipping_address_2.empty? %>
			<%= @order.shipping_address_2 %>
			<br />
			<% end %>
			<%= @order.shipping_city %>,&nbsp;<%= @order.state.name %>&nbsp;<%= @order.shipping_zip %>
			<br />
			<%= @order.country.name %>
			<br />
		</div>
		<div class="col-md-6">
			<br />
			<h5>Payment Method</h5>
			VISA &nbsp;**** &nbsp;4369
		</div>
		<div class="col-md-3">
			<br />
			<h5>Order Summary</h5>
			Item(s) Subtotal: $<%= @order.before_price %>
			<br />
			Shipping & Handling: $<%= @order.shipping_price %>
			<br />
			Total before tax: $<%= @order.before_price + @order.shipping_price %>
			<br />
			Tax collected: $<%= @order.tax_price %>
			<br />
			<br />
			<b>Grand Total: $<%= @order.total_price %></b>
			<br />
		</div>
	</div>
	<div class="row box" style="margin-top: 20px;">

		<% @order.items.each_with_index do |item, ix| %>
		<div class="row">

			<div class="container">
				<div class="row">
					<div class="col-md-9">
						<br />
					
						<%= image_tag get_image_url(item, "overview"), class: "overview_image image_shadow_in_order_show", id: "item_#{item.id}" %>
								<div>
									<div class="triptych_1_in_order_show image_shadow_in_order_show" id="item_<%= item.id%>_triple_1"></div>
									<div class="triptych_2_in_order_show image_shadow_in_order_show"  id="item_<%= item.id%>_triple_2" style="margin-left: 8px; margin-right: 8px"></div>
									<div class="triptych_3_in_order_show image_shadow_in_order_show" id="item_<%= item.id%>_triple_3"></div>
								</div>
					</div>

					<div class="col-md-3" >
						<br />
						
						
						Type: <%= item.product.name %>
						<br />
						Size: <%= item.size %>
						<br />
						<% if item.product.name.include?('canvas')%>
							Depth: <%= item.depth %>
							<br />
							Border: <%= item.border %>								
						<% else %>
							Frame: <%= Frame.find(item.frame_id).name %>
							<br />
							Mat: <%= "#{item.mat}\"".gsub("0.0\"", "No") %>								
						<% end %>
						

					</div>

				</div>
				<div class="row">
					<div class="col-md-9"></div>
					<div class="col-md-3">
						Quantity: <b><%= item.quantity %></b><br />
						Subtotal: $<b><%= item.price*item.quantity %></b>					
					</div>
				</div>
				<% if ix != @order.items.count - 1 %>
					<hr style="width: 100%; border-color:#EDEDED;"/>
				<% else %>
					<br />
				<% end %>
			</div>
		</div>
		<% end %>
	</div>
</div>

<script>

	$( window ).on( "load", function(){

			<% @order.items.each do |item| %>
			// Add frame effects if necessary
			if (<%= image_is_framed(item) %>){
				// Add frame
				if (<%= image_is_framed_with_type(item, 'black') %>){
					$('#item_' + <%= item.id %>).addClass('image_black_frame');
				} else if (<%= image_is_framed_with_type(item, 'white') %>) {
					$('#item_' + <%= item.id %>).addClass('image_white_frame');
				} else {
					$('#item_' + <%= item.id %>).addClass('image_brown_frame');
				}
				// Add mat
				if (<%= item.mat == 2.5 %>){
					$('#item_' + <%= item.id %>).css('padding', '15px');
				}
			} else if (<%= image_is_triptych(item) %>){
				// Add triptych effects if necessary
				divide_image_to_3('item_' + <%= item.id %>, 'item_' +<%= item.id %> + '_triple');
			}

			<% end %>
	
	});

	function divide_image_to_3(image_id, div_id) {
		$('#' + image_id).hide();
		$('#' + div_id + '_1').show();
		$('#' + div_id + '_2').show();
		$('#' + div_id + '_3').show();

		var image_url = $('#' + image_id).attr('src');
		var image_width = $('#' + image_id).width();
		var image_width_3 = parseInt($('#' + image_id).width() / 3);
		var image_height = $('#' + image_id).height();
		$('#' + div_id + '_1').css('background', 'url(' + image_url + ') 0 0');
		$('#' + div_id + '_1').css('width', image_width_3 + 'px');
		$('#' + div_id + '_1').css('height', image_height + 'px');

		$('#' + div_id + '_2').css('background', 'url(' + image_url + ') -' + image_width_3 + 'px 0');
		$('#' + div_id + '_2').css('width', image_width_3 + 'px');
		$('#' + div_id + '_2').css('height', image_height + 'px');

		$('#' + div_id + '_3').css('background', 'url(' + image_url + ') -' + image_width_3 * 2 + 'px 0');
		$('#' + div_id + '_3').css('width', image_width_3 + 'px');
		$('#' + div_id + '_3').css('height', image_height + 'px');
	}

</script>
